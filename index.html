<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body>
    <ul id="messages"></ul>
    <input id="m" autocomplete="off" /><button onclick="send()">Send</button>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
      var socket = io();

      const peer = new Peer(`${Date.now()}`, {
        host: "localhost",
        port: 4000,
        path: "/peerjs/myapp",
      });

      let conn;
      var aconn;

      function send() {
        socket.emit("username", { username: "teezzanHAssanYusuf" });
        $("#m").val("");
        return false;
      }
      function sendmessage(text, username) {
        var pay = { text, to: username };
        socket.emit("send_message", pay);
      }

      socket.on("username", function (msg) {
        console.log(msg);
      });

      socket.on("authorization", function (msg) {
        console.log("authorization =>", msg);
      });

      peer.on("open", function (id) {
        console.log("My peer ID is: " + id);
      });

      peer.on("connection", (conn) => {
        aconn = conn;
        console.log("connected from :", conn.peer);
        conn.on("data", function (data) {
          console.log("Received", data);
        });
      });

      function connect(id) {
        conn = peer.connect(id);
        // on open will be launch when you successfully connect to PeerServer
        conn.on("open", function () {
          // here you have conn.id
          conn.send("hi!");
          conn.on("data", function (data) {
            console.log("Received", data);
          });
        });
      }
    </script>
  </body>
</html>
